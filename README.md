# lisp-interpreter
这是一个用python实现的lisp子集的解释器
基本思路按照王垠的[文章](http://www.yinwang.org/blog-cn/2012/08/01/interpreter)   
目前实现了以下特性：  
- 基本四则运算
- lambda函数，词法闭包
- 变量绑定
- 函数调用

下面讲一讲解释器的基本思路：
## 1.词法分析
词法分析利用python自带的re即可完成，python的re有命名捕获的功能，使词法分析方便了不少。

## 2.语法分析
语法分析很简单，由于lisp的语句几乎全是S-表达式一种结构，只需要通过递归地分析即可将语法结构从字符串中解析出来，具体地，对于一个形如`(f (g x y) z)`这样的表达式，我们先去除左括号，再对剩下的`f`,`(g x y)`,`z`递归地进行处理，并将处理后的结果加入一个列表lst，直到遇到右括号表示到结尾，这时列表lst就是这个表达式解析的结果，这里解析的结果是python中的一个数组`[f, [g, x, y], z]`。由此便可以将一个字符串解析成python的数据结构。

## 3.解释执行
- 作用域scope  
像`(let (x 1) (+ x 2))`这样的语句会将x绑定到1上，然后产生一个scope，一个scope记录了变量的绑定值，就像一个字典一样。比如这里的scope就是{'x': 1}.  
- 环境env  
env是一个stack，由scope组成，每进入一个scope，env便会将这个scope压栈，执行这个scope范围内语句的时候会从env的栈顶开始查找变量的绑定，如果遍历了整个env都没找到会raise一个UnBoundError的异常。离开这个scope的时候会弹栈。
- lambda表达式  
目前可调用对象都采用lambda表达式实现，每个lambda表达式都返回一个可调用对象，被调用时像let一样绑定参数形成一个scope，然后执行表达式体中的语句。
- 闭包closure  
闭包又叫词法闭包，是一个lambda表达式及其捕获的外界环境变量组成的结构，这里我不管它捕没捕获，都将闭包定义时的env作一个deepcopy保存下来，在这个闭包被调用时便用保存下来的env和当前的参数来执行保存下来的lambda表达式体。
